<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K3RS/MFK - Rumah Sakit Umum Daerah Talaud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://fpcdn.io/v3/1L3Y8V8X5W9A2C3E6F7G8H9J0K1L2M3N4O5P6Q7R8S9T0U1V2W3X4Y5Z6.js"></script>
    <style>
        /* Reset CSS untuk mobile */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f9fafb;
            color: #1f2937;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Prevent horizontal scroll */
        html {
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        
        /* Custom scrollbar for mobile */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Prevent text selection */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Prevent double tap zoom */
        * {
            touch-action: manipulation;
        }
        
        /* Prevent iOS rubber band effect */
        html, body {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .scroll-container {
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Card styles */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Header styles */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .logo p {
            font-size: 11px;
            opacity: 0.9;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .time-display {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 4px 12px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 12px;
        }
        
        .year-selector {
            display: flex;
            gap: 4px;
        }
        
        .year-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .year-btn.active {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .year-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Menu styles */
        .menu-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .menu-toggle i {
            color: white;
            font-size: 18px;
        }
        
        /* Main content */
        .main-content {
            margin-top: 64px;
            padding: 16px;
            padding-bottom: 80px;
        }
        
        /* Summary cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            text-align: center;
        }
        
        .summary-card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
        }
        
        .summary-card-icon i {
            font-size: 20px;
        }
        
        .summary-card-title {
            font-size: 10px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .summary-card-value {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 2px;
        }
        
        .summary-card-desc {
            font-size: 10px;
            color: #6b7280;
        }
        
        /* Chart container */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1f2937;
        }
        
        .chart-wrapper {
            height: 200px;
            position: relative;
        }
        
        /* Quick links */
        .quick-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .quick-link-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .quick-link-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1f2937;
        }
        
        .quick-link-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .quick-link-item:last-child {
            border-bottom: none;
        }
        
        .quick-link-name {
            font-size: 13px;
            font-weight: 500;
        }
        
        .quick-link-value {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-warning {
            background: #fed7aa;
            color: #92400e;
        }
        
        .status-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* Navigation */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4px 8px;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            border-radius: 8px;
            margin: 0 2px;
        }
        
        .nav-item.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .nav-item i {
            font-size: 20px;
            margin-bottom: 2px;
        }
        
        .nav-item span {
            font-size: 11px;
        }
        
        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
        }
        
        .modal-body {
            padding: 16px;
        }
        
        /* Team Modal Styles */
        .team-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .team-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .team-modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        
        .team-modal.active .team-modal-content {
            transform: scale(1);
        }
        
        .team-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .team-modal-body {
            padding: 16px;
        }
        
        .team-member {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .team-member:hover {
            background: #f3f4f6;
            transform: translateX(4px);
        }
        
        .team-member-icon {
            width: 40px;
            height: 40px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-size: 18px;
        }
        
        .team-member-info {
            flex: 1;
        }
        
        .team-member-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .team-member-role {
            font-size: 12px;
            color: #6b7280;
        }
        
        /* Tab styles */
        .tabs {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            padding-bottom: 8px;
            margin-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            background: white;
            border: 1px solid #e5e7eb;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* Room grid */
        .room-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .room-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .room-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .room-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .room-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Search styles */
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            font-size: 14px;
            background: white;
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
        
        /* Gallery styles */
        .gallery-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .gallery-filters::-webkit-scrollbar {
            display: none;
        }
        
        .filter-btn {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            aspect-ratio: 1;
            cursor: default;
            pointer-events: none;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            user-select: none;
        }
        
        /* Summary text */
        .summary-text {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }
        
        .summary-text-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1f2937;
        }
        
        .summary-text p {
            font-size: 13px;
            line-height: 1.5;
            color: #4b5563;
        }
        
        /* Risk matrix table */
        .risk-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-bottom: 16px;
        }
        
        .risk-table th,
        .risk-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        .risk-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .risk-low {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .risk-medium {
            background-color: #fed7aa;
            color: #92400e;
        }
        
        .risk-high {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Compliance table */
        .compliance-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-bottom: 16px;
        }
        
        .compliance-table th,
        .compliance-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        .compliance-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .compliance-good {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .compliance-medium {
            background-color: #fed7aa;
            color: #92400e;
        }
        
        .compliance-poor {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Recommendations */
        .recommendations {
            background: #f9fafb;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .recommendations-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1f2937;
        }
        
        .recommendations-list {
            list-style: none;
        }
        
        .recommendations-list li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 6px;
            font-size: 13px;
            color: #4b5563;
        }
        
        .recommendations-list li:before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            .summary-cards {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .quick-links {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .room-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Print prevention */
        @media print {
            body * {
                visibility: hidden;
            }
            #securityOverlay, #securityOverlay * {
                visibility: visible;
            }
            #securityOverlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: white;
                z-index: 99999;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }
        }
        
        /* Login styles */
        .login-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 24px;
            max-width: 400px;
            margin: 80px auto;
        }
        
        .login-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 24px;
            color: #1f2937;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-input {
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .user-name {
            font-size: 14px;
            font-weight: 600;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .locked-nav-item {
            position: relative;
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .locked-nav-item::after {
            content: '\f023';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 10px;
            color: #ef4444;
        }
        
        /* Pull to refresh styles */
        .pull-to-refresh {
            position: fixed;
            top: -60px;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            transition: top 0.3s ease;
            z-index: 1001;
        }
        
        .pull-to-refresh.active {
            top: 0;
        }
        
        .pull-to-refresh i {
            margin-right: 8px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Guest logout button */
        .guest-logout {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
        }
        
        .guest-logout:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .guest-logout i {
            font-size: 18px;
        }
    </style>
</head>
<body>
    <!-- Security overlay -->
    <div id="securityOverlay" style="display: none;">
        <div class="text-center">
            <i class="fas fa-lock text-6xl text-gray-400 mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-700 mb-2">Akses Diblokir</h2>
            <p class="text-gray-600">Anda tidak dapat mencetak atau mengambil tangkapan layar dari halaman ini.</p>
        </div>
    </div>

    <!-- Pull to refresh indicator -->
    <div id="pullToRefresh" class="pull-to-refresh">
        <i class="fas fa-sync-alt"></i>
        <span>Refresh...</span>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="scroll-container" style="display: none;">
        <div class="login-container">
            <h2 class="login-title">Login K3RS/MFK</h2>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="username">ID Petugas K3RS/MFK</label>
                    <input type="text" id="username" class="form-input" placeholder="Masukkan ID Petugas" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-600">Login sebagai <a href="#" onclick="loginAsGuest()" class="text-blue-600">Tamu</a></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="scroll-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1>K3RS/MFK</h1>
                    <p>Rumah Sakit Umum Daerah Talaud</p>
                </div>
                <div class="header-actions">
                    <div class="user-info" id="userInfo" style="display: none;">
                        <span class="user-name" id="userName">Admin</span>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                    <div class="time-display" id="clock">00:00:00</div>
                    <div class="year-selector">
                        <button class="year-btn active" onclick="setYear(2024)">2024</button>
                        <button class="year-btn" onclick="setYear(2025)">2025</button>
                    </div>
                    <button class="menu-toggle" onclick="toggleMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button class="guest-logout" id="guestLogout" style="display: none;" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main content -->
        <main class="main-content">
            <!-- Dashboard -->
            <div id="dashboard" class="content-section">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Dashboard K3RS/MFK</h2>
                
                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="summary-card-icon bg-blue-100">
                            <i class="fas fa-exclamation-triangle text-blue-600"></i>
                        </div>
                        <div class="summary-card-title">Total Risiko</div>
                        <div class="summary-card-value">156</div>
                        <div class="summary-card-desc">24 ruangan</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-icon bg-red-100">
                            <i class="fas fa-fire text-red-600"></i>
                        </div>
                        <div class="summary-card-title">Kebakaran</div>
                        <div class="summary-card-value">24</div>
                        <div class="summary-card-desc">Insiden terdeteksi</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-icon bg-green-100">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                        <div class="summary-card-title">Kepatuhan</div>
                        <div class="summary-card-value">87%</div>
                        <div class="summary-card-desc">Rata-rata</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-icon bg-purple-100">
                            <i class="fas fa-tools text-purple-600"></i>
                        </div>
                        <div class="summary-card-title">Pemeliharaan</div>
                        <div class="summary-card-value">89%</div>
                        <div class="summary-card-desc">Fasilitas baik</div>
                    </div>
                </div>

                <!-- Summary Findings -->
                <div class="summary-text">
                    <h3 class="summary-text-title">Ringkasan Temuan Tahunan</h3>
                    <p>
                        Berdasarkan inspeksi selama setahun, teridentifikasi 156 risiko aktif di 24 ruangan. 
                        Kategori terbanyak adalah keamanan dengan tingkat kepatuhan 94%, diikuti kebakaran 91% 
                        dan fasilitas 89%. Ruangan dengan risiko tertinggi adalah IGD dengan 18 risiko, ICU dengan 15 risiko, 
                        dan Laboratorium dengan 12 risiko.
                    </p>
                </div>
                
                <div class="summary-text">
                    <h3 class="summary-text-title">Ringkasan Inspeksi APAR</h3>
                    <p>
                        Dari 24 ruangan, hanya 5 ruangan yang dilengkapi APAR 2kg (IGD, Kantor, Medrec, Gizi, IPSRS). 
                        Tiga di antaranya perlu diisi ulang (IGD, Medrec, Kantor). 
                        Rekomendasi segera pasang APAR di ruangan yang belum memiliki dan lakukan pengisian ulang 
                        untuk yang sudah terpasang tetapi perlu diisi.
                    </p>
                </div>

                <!-- Monthly Trend Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Tren K3RS Bulanan</h3>
                    <div class="chart-wrapper">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="quick-links">
                    <div class="quick-link-card">
                        <h3 class="quick-link-title">Ruangan dengan Risiko Tertinggi</h3>
                        <div class="quick-link-item">
                            <span class="quick-link-name">IGD</span>
                            <span class="quick-link-value status-danger">18 risiko</span>
                        </div>
                        <div class="quick-link-item">
                            <span class="quick-link-name">ICU</span>
                            <span class="quick-link-value status-warning">15 risiko</span>
                        </div>
                        <div class="quick-link-item">
                            <span class="quick-link-name">LABORATORIUM</span>
                            <span class="quick-link-value status-warning">12 risiko</span>
                        </div>
                    </div>

                    <div class="quick-link-card">
                        <h3 class="quick-link-title">Kategori K3RS Terbaik</h3>
                        <div class="quick-link-item">
                            <span class="quick-link-name">Keamanan</span>
                            <span class="quick-link-value status-success">94% kepatuhan</span>
                        </div>
                        <div class="quick-link-item">
                            <span class="quick-link-name">Kebakaran</span>
                            <span class="quick-link-value status-success">91% kepatuhan</span>
                        </div>
                        <div class="quick-link-item">
                            <span class="quick-link-name">Fasilitas</span>
                            <span class="quick-link-value status-info">89% kepatuhan</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Laporan Inspeksi APAR -->
            <div id="apar" class="content-section hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Laporan Inspeksi APAR</h2>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="aparSearch" placeholder="Cari ruangan..." class="search-input">
                </div>
                
                <!-- Monthly Tabs -->
                <div class="tabs" id="aparTabs">
                    <button class="tab active" onclick="showMonthlyApar('jan')">Jan</button>
                    <button class="tab" onclick="showMonthlyApar('feb')">Feb</button>
                    <button class="tab" onclick="showMonthlyApar('mar')">Mar</button>
                    <button class="tab" onclick="showMonthlyApar('apr')">Apr</button>
                    <button class="tab" onclick="showMonthlyApar('mei')">Mei</button>
                    <button class="tab" onclick="showMonthlyApar('jun')">Jun</button>
                    <button class="tab" onclick="showMonthlyApar('jul')">Jul</button>
                    <button class="tab" onclick="showMonthlyApar('agu')">Agu</button>
                    <button class="tab" onclick="showMonthlyApar('sep')">Sep</button>
                    <button class="tab" onclick="showMonthlyApar('okt')">Okt</button>
                    <button class="tab" onclick="showMonthlyApar('nov')">Nov</button>
                    <button class="tab" onclick="showMonthlyApar('des')">Des</button>
                </div>

                <!-- Room Grid -->
                <div class="room-grid" id="aparGrid">
                    <!-- Ruangan akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Galeri Kegiatan -->
            <div id="galeri" class="content-section hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Galeri Kegiatan K3RS</h2>
                
                <!-- Filter Buttons -->
                <div class="gallery-filters">
                    <button class="filter-btn active" onclick="filterGallery('all')">Semua</button>
                    <button class="filter-btn" onclick="filterGallery('kebakaran')">Kebakaran</button>
                    <button class="filter-btn" onclick="filterGallery('bencana')">Bencana</button>
                    <button class="filter-btn" onclick="filterGallery('keamanan')">Keamanan</button>
                    <button class="filter-btn" onclick="filterGallery('fasilitas')">Fasilitas</button>
                </div>
                
                <!-- Gallery Grid -->
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Gallery items will be inserted here -->
                </div>
            </div>

            <!-- Laporan Manajemen Kebakaran -->
            <div id="kebakaran" class="content-section hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Laporan Manajemen Kebakaran</h2>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="fireSearch" placeholder="Cari ruangan..." class="search-input">
                </div>
                
                <!-- Monthly Tabs -->
                <div class="tabs" id="kebakaranTabs">
                    <button class="tab active" onclick="showMonthlyKebakaran('jan')">Jan</button>
                    <button class="tab" onclick="showMonthlyKebakaran('feb')">Feb</button>
                    <button class="tab" onclick="showMonthlyKebakaran('mar')">Mar</button>
                    <button class="tab" onclick="showMonthlyKebakaran('apr')">Apr</button>
                    <button class="tab" onclick="showMonthlyKebakaran('mei')">Mei</button>
                    <button class="tab" onclick="showMonthlyKebakaran('jun')">Jun</button>
                    <button class="tab" onclick="showMonthlyKebakaran('jul')">Jul</button>
                    <button class="tab" onclick="showMonthlyKebakaran('agu')">Agu</button>
                    <button class="tab" onclick="showMonthlyKebakaran('sep')">Sep</button>
                    <button class="tab" onclick="showMonthlyKebakaran('okt')">Okt</button>
                    <button class="tab" onclick="showMonthlyKebakaran('nov')">Nov</button>
                    <button class="tab" onclick="showMonthlyKebakaran('des')">Des</button>
                </div>

                <!-- Room Grid -->
                <div class="room-grid" id="kebakaranGrid">
                    <!-- Ruangan akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Laporan Manajemen Bencana -->
            <div id="bencana" class="content-section hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Laporan Manajemen Bencana</h2>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="disasterSearch" placeholder="Cari ruangan..." class="search-input">
                </div>
                
                <!-- Monthly Tabs -->
                <div class="tabs" id="bencanaTabs">
                    <button class="tab active" onclick="showMonthlyBencana('jan')">Jan</button>
                    <button class="tab" onclick="showMonthlyBencana('feb')">Feb</button>
                    <button class="tab" onclick="showMonthlyBencana('mar')">Mar</button>
                    <button class="tab" onclick="showMonthlyBencana('apr')">Apr</button>
                    <button class="tab" onclick="showMonthlyBencana('mei')">Mei</button>
                    <button class="tab" onclick="showMonthlyBencana('jun')">Jun</button>
                    <button class="tab" onclick="showMonthlyBencana('jul')">Jul</button>
                    <button class="tab" onclick="showMonthlyBencana('agu')">Agu</button>
                    <button class="tab" onclick="showMonthlyBencana('sep')">Sep</button>
                    <button class="tab" onclick="showMonthlyBencana('okt')">Okt</button>
                    <button class="tab" onclick="showMonthlyBencana('nov')">Nov</button>
                    <button class="tab" onclick="showMonthlyBencana('des')">Des</button>
                </div>

                <!-- Room Grid -->
                <div class="room-grid" id="bencanaGrid">
                    <!-- Ruangan akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Laporan Manajemen Keamanan -->
            <div id="keamanan" class="content-section hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Laporan Manajemen Keamanan</h2>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="securitySearch" placeholder="Cari ruangan..." class="search-input">
                </div>
                
                <!-- Monthly Tabs -->
                <div class="tabs" id="keamananTabs">
                    <button class="tab active" onclick="showMonthlyKeamanan('jan')">Jan</button>
                    <button class="tab" onclick="showMonthlyKeamanan('feb')">Feb</button>
                    <button class="tab" onclick="showMonthlyKeamanan('mar')">Mar</button>
                    <button class="tab" onclick="showMonthlyKeamanan('apr')">Apr</button>
                    <button class="tab" onclick="showMonthlyKeamanan('mei')">Mei</button>
                    <button class="tab" onclick="showMonthlyKeamanan('jun')">Jun</button>
                    <button class="tab" onclick="showMonthlyKeamanan('jul')">Jul</button>
                    <button class="tab" onclick="showMonthlyKeamanan('agu')">Agu</button>
                    <button class="tab" onclick="showMonthlyKeamanan('sep')">Sep</button>
                    <button class="tab" onclick="showMonthlyKeamanan('okt')">Okt</button>
                    <button class="tab" onclick="showMonthlyKeamanan('nov')">Nov</button>
                    <button class="tab" onclick="showMonthlyKeamanan('des')">Des</button>
                </div>

                <!-- Room Grid -->
                <div class="room-grid" id="keamananGrid">
                    <!-- Ruangan akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Laporan Manajemen B3 -->
            <div id="b3" class="content-section hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Laporan Manajemen B3</h2>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="b3Search" placeholder="Cari ruangan..." class="search-input">
                </div>
                
                <!-- Monthly Tabs -->
                <div class="tabs" id="b3Tabs">
                    <button class="tab active" onclick="showMonthlyB3('jan')">Jan</button>
                    <button class="tab" onclick="showMonthlyB3('feb')">Feb</button>
                    <button class="tab" onclick="showMonthlyB3('mar')">Mar</button>
                    <button class="tab" onclick="showMonthlyB3('apr')">Apr</button>
                    <button class="tab" onclick="showMonthlyB3('mei')">Mei</button>
                    <button class="tab" onclick="showMonthlyB3('jun')">Jun</button>
                    <button class="tab" onclick="showMonthlyB3('jul')">Jul</button>
                    <button class="tab" onclick="showMonthlyB3('agu')">Agu</button>
                    <button class="tab" onclick="showMonthlyB3('sep')">Sep</button>
                    <button class="tab" onclick="showMonthlyB3('okt')">Okt</button>
                    <button class="tab" onclick="showMonthlyB3('nov')">Nov</button>
                    <button class="tab" onclick="showMonthlyB3('des')">Des</button>
                </div>

                <!-- Room Grid -->
                <div class="room-grid" id="b3Grid">
                    <!-- Ruangan akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Laporan Manajemen Fasilitas -->
            <div id="fasilitas" class="content-section hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Laporan Manajemen Fasilitas</h2>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="facilitySearch" placeholder="Cari ruangan..." class="search-input">
                </div>
                
                <!-- Monthly Tabs -->
                <div class="tabs" id="fasilitasTabs">
                    <button class="tab active" onclick="showMonthlyFasilitas('jan')">Jan</button>
                    <button class="tab" onclick="showMonthlyFasilitas('feb')">Feb</button>
                    <button class="tab" onclick="showMonthlyFasilitas('mar')">Mar</button>
                    <button class="tab" onclick="showMonthlyFasilitas('apr')">Apr</button>
                    <button class="tab" onclick="showMonthlyFasilitas('mei')">Mei</button>
                    <button class="tab" onclick="showMonthlyFasilitas('jun')">Jun</button>
                    <button class="tab" onclick="showMonthlyFasilitas('jul')">Jul</button>
                    <button class="tab" onclick="showMonthlyFasilitas('agu')">Agu</button>
                    <button class="tab" onclick="showMonthlyFasilitas('sep')">Sep</button>
                    <button class="tab" onclick="showMonthlyFasilitas('okt')">Okt</button>
                    <button class="tab" onclick="showMonthlyFasilitas('nov')">Nov</button>
                    <button class="tab" onclick="showMonthlyFasilitas('des')">Des</button>
                </div>

                <!-- Room Grid -->
                <div class="room-grid" id="fasilitasGrid">
                    <!-- Ruangan akan diisi oleh JavaScript -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white text-center py-3 text-xs">
            <p>&copy; 2024-2025 K3RS/MFK RSUD Talaud. Tim Pengembang: Divisi K3RS/MFK RSUD Talaud</p>
        </footer>

        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-item active" onclick="showSection('dashboard')">
                <i class="fas fa-home text-blue-600"></i>
                <span>Beranda</span>
            </div>
            <div class="nav-item locked-nav-item" id="navApar" onclick="showSection('apar')">
                <i class="fas fa-fire-extinguisher text-red-600"></i>
                <span>APAR</span>
            </div>
            <div class="nav-item locked-nav-item" id="navKebakaran" onclick="showSection('kebakaran')">
                <i class="fas fa-fire text-orange-600"></i>
                <span>Kebakaran</span>
            </div>
            <div class="nav-item locked-nav-item" id="navBencana" onclick="showSection('bencana')">
                <i class="fas fa-cloud-showers-heavy text-blue-500"></i>
                <span>Bencana</span>
            </div>
            <div class="nav-item locked-nav-item" id="navKeamanan" onclick="showSection('keamanan')">
                <i class="fas fa-shield-alt text-purple-600"></i>
                <span>Keamanan</span>
            </div>
            <div class="nav-item locked-nav-item" id="navB3" onclick="showSection('b3')">
                <i class="fas fa-flask text-green-600"></i>
                <span>B3</span>
            </div>
            <div class="nav-item locked-nav-item" id="navFasilitas" onclick="showSection('fasilitas')">
                <i class="fas fa-building text-indigo-600"></i>
                <span>Fasilitas</span>
            </div>
            <div class="nav-item" onclick="showSection('galeri')">
                <i class="fas fa-images text-pink-600"></i>
                <span>Galeri</span>
            </div>
        </nav>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Detail Laporan</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- Detail content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Team Modal -->
    <div id="teamModal" class="team-modal">
        <div class="team-modal-content">
            <div class="team-modal-header">
                <h3 class="modal-title">Tim K3RS/MFK RSUD Talaud</h3>
                <button class="modal-close" onclick="closeTeamModal()">&times;</button>
            </div>
            <div class="team-modal-body">
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Dr. dr. Jawali J. Ektivianus, M.Kes</div>
                        <div class="team-member-role">Penanggung Jawab</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Sonny H. Larenggam, SKM</div>
                        <div class="team-member-role">Ketua</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Jhosua V. Malendes, S.K.M</div>
                        <div class="team-member-role">Sekretaris</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Hermanus J. Gagola</div>
                        <div class="team-member-role">Pengamanan Peralatan Medik</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-radiation"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Irma Emuan, S.Tr.Kes</div>
                        <div class="team-member-role">Pengamanan Radiasi dan Limbah Radioaktif</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">James Abraham</div>
                        <div class="team-member-role">Pengamanan Peralatan Non Medik</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Aster Waloni</div>
                        <div class="team-member-role">Pengamanan dan Keselamatan Bangunan</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Rafles Maitum, S.Kep</div>
                        <div class="team-member-role">Pelayanan Kesehatan Kerja dan Pencegahan Penyakit Akibat Kerja</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Ferdian Alungunusa</div>
                        <div class="team-member-role">Bidang Pencegangan dan Penanggulangan Bencana</div>
                    </div>
                </div>
                <div class="team-member">
                    <div class="team-member-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="team-member-info">
                        <div class="team-member-name">Rizky Mangalo</div>
                        <div class="team-member-role">Bidang Pencegahan dan Penanggulangan Bencana</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Device fingerprinting
        let deviceFingerprint = '';
        let sessionValid = true;
        let currentYear = 2024;
        let currentFilter = null;
        let currentUser = null;
        
        // Pull to refresh variables
        let pullStartY = 0;
        let pullDistance = 0;
        let isPulling = false;
        let isRefreshing = false;
        
        // Initialize fingerprint
        async function initFingerprint() {
            const fp = await FingerprintJS.load();
            const result = await fp.get();
            deviceFingerprint = result.visitorId;
            localStorage.setItem('deviceFingerprint', deviceFingerprint);
            checkDevice();
        }
        
        // Check device fingerprint
        function checkDevice() {
            const storedFingerprint = localStorage.getItem('deviceFingerprint');
            if (storedFingerprint && storedFingerprint !== deviceFingerprint) {
                // Device changed
                alert('Perangkat berubah. Sesi Anda akan diakhiri.');
                setTimeout(() => {
                    logout();
                }, 3000);
            } else {
                sessionValid = true;
            }
        }
        
        // Logout function
        function logout() {
            sessionValid = false;
            currentUser = null;
            localStorage.removeItem('sessionValid');
            localStorage.removeItem('currentUser');
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            updateNavigationForGuest();
        }
        
        // Prevent screenshot and print
        function preventScreenshot() {
            // Disable print
            window.addEventListener('beforeprint', () => {
                document.getElementById('securityOverlay').classList.add('active');
            });
            
            window.addEventListener('afterprint', () => {
                document.getElementById('securityOverlay').classList.remove('active');
            });
            
            // Disable keyboard shortcuts for screenshots
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    document.getElementById('securityOverlay').classList.add('active');
                    setTimeout(() => {
                        document.getElementById('securityOverlay').classList.remove('active');
                    }, 2000);
                }
            });
            
            // Disable context menu (right-click)
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
            
            // Disable drag and drop
            document.addEventListener('dragstart', (e) => {
                e.preventDefault();
            });
        }

        // Gallery data
        const galleryData = [
            {
                id: 1,
                title: "Inspeksi Kebakaran",
                description: "Tim K3RS melakukan inspeksi rutin pada sistem kebakaran",
                category: "kebakaran",
                image: "https://z-cdn-media.chatglm.cn/files/dbcad338-972d-4d3e-ad22-55a77b631623_image_2025-11-08_10-32-20.jpg?auth_key=1864024247-6006c6c0c8d240d48000abc6410a0b73-0-8a9fdcb30e3a6a5d49095dc2745887b5",
                date: "08/07/2024"
            },
            {
                id: 2,
                title: "Kegiatan Evakuasi",
                description: "Simulasi evakuasi darurat untuk mengantisipasi bencana",
                category: "bencana",
                image: "https://z-cdn-media.chatglm.cn/files/3b53d5c8-2fa0-4499-adf3-68bfc6859eae_image_2025-11-08_10-34-45.jpg?auth_key=1864024247-f1736f746b1c48b59a5e0f072728d26c-0-b4a85564e0a39b234c99c2c7af386cb7",
                date: "08/07/2024"
            },
            {
                id: 3,
                title: "Pemeriksaan APAR",
                description: "Pemeriksaan alat pemadam api ringan (APAR) di berbagai lokasi",
                category: "kebakaran",
                image: "https://z-cdn-media.chatglm.cn/files/81e22945-66aa-444b-9887-4dc3b54b09cc_Gambar%20WhatsApp%202024-07-09%20pukul%2003.46.38_e05dce3c.jpg?auth_key=1864024247-b7c0fbc8e6ee42ba802ab5d6a843cee9-0-34a239f8c26b1a9f2303dddb1d4f5d77",
                date: "08/07/2024"
            },
            {
                id: 4,
                title: "SOP Kebakaran",
                description: "Pelatihan standar operasional prosedur kebakaran",
                category: "kebakaran",
                image: "https://z-cdn-media.chatglm.cn/files/3590e765-d758-4e3c-8b1d-cdf09fc31fcc_Gambar%20WhatsApp%202024-07-09%20pukul%2003.46.39_2aadbb72.jpg?auth_key=1864024247-3207ae00ccfe431084f126a5d899ae07-0-3f5a1fe1c8b19465f27e4af5acc806b7",
                date: "08/07/2024"
            },
            {
                id: 5,
                title: "Instalasi Gawat Darurat",
                description: "Tim K3RS bersama tim medis di instalasi gawat darurat",
                category: "fasilitas",
                image: "https://z-cdn-media.chatglm.cn/files/9dece0de-4005-4fc6-81e5-ffeb4f55fd17_Gambar%20WhatsApp%202024-07-09%20pukul%2003.46.39_552b8122.jpg?auth_key=1864024247-70534329ea6743c6bfc93caa214e2929-0-70462578f9bc7c2a55f5886c3aea4866",
                date: "08/07/2024"
            },
            {
                id: 6,
                title: "Simulasi Kebakaran",
                description: "Simulasi penanggulangan kebakaran di area laboratorium",
                category: "kebakaran",
                image: "https://z-cdn-media.chatglm.cn/files/1fe7e6d4-f97b-49ba-8d19-be97a462b8ab_Gambar%20WhatsApp%202024-07-09%20pukul%2003.46.42_baedbeec.jpg?auth_key=1864024247-a89c77198f6e43f8b24794a9a40bceab-0-2ed94376c27858bac53522d143f4dcc3",
                date: "08/07/2024"
            },
            {
                id: 7,
                title: "Pemeriksaan Keamanan",
                description: "Tim keamanan melakukan patroli di area kritis",
                category: "keamanan",
                image: "https://z-cdn-media.chatglm.cn/files/a0b1ac9c-133f-4c02-a021-3f24b9375626_Gambar%20WhatsApp%202024-07-09%20pukul%2003.46.43_4bb1e586.jpg?auth_key=1864024247-1b05a3f2db8f48a8a3c7b5b219bc48b9-0-ebe994467440e740d0eceaa4f34cea27",
                date: "08/07/2024"
            },
            {
                id: 8,
                title: "Tim Tanggap Darurat",
                description: "Foto bersama tim tanggap darurat RSUD Talaud",
                category: "bencana",
                image: "https://z-cdn-media.chatglm.cn/files/deef1b58-a485-4fee-9b45-6b9852628f0f_Gambar%20WhatsApp%202024-07-09%20pukul%2003.46.06_404016de.jpg?auth_key=1864024247-f59bb4c9c7a84537af1a80353ea79082-0-1fd573511b01160e7e54154968f25115",
                date: "08/07/2024"
            }
        ];

        // Initialize gallery
        function initGallery() {
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = galleryData.map(item => `
                <div class="gallery-item" data-category="${item.category}">
                    <img src="${item.image}" alt="${item.title}" loading="lazy">
                </div>
            `).join('');
        }

        // Filter gallery
        function filterGallery(category) {
            const items = document.querySelectorAll('.gallery-item');
            const buttons = document.querySelectorAll('.filter-btn');
            
            // Update active button
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(category) || 
                    (category === 'all' && btn.textContent === 'Semua')) {
                    btn.classList.add('active');
                }
            });
            
            // Filter items
            items.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Data untuk ruangan-ruangan
        const rooms = [
            'ANGGREK', 'APOTEK/FARMASI', 'BINATU', 'CRYSANT', 'DAHLIA', 
            'EDELWEIS', 'FISIOTERAPI', 'GUDANG APOTEK', 'IBS', 'ICU', 
            'IGD', 'IGD VK', 'INSTALASI GIZI', 'IPSRS', 'ISOLASI', 
            'KANTOR', 'LABORATORIUM', 'MEDREC', 'NICU', 'PEMULASARAN JENAZAH', 
            'POLIKLINIK', 'POS SATPAM', 'RADIOLODI'
        ];

        // Ruangan yang memiliki APAR 2kg
        const roomsWithApar = ['IGD', 'KANTOR', 'MEDREC', 'INSTALASI GIZI', 'IPSRS'];
        
        // Ruangan yang perlu diisi ulang
        const roomsNeedRefill = ['IGD', 'MEDREC', 'KANTOR'];

        // Generate random data for demonstration
        function generateRandomData(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Set year function
        function setYear(year) {
            currentYear = year;
            
            // Update year buttons
            const yearButtons = document.querySelectorAll('.year-btn');
            yearButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent == year) {
                    btn.classList.add('active');
                }
            });
            
            // Update chart data based on year
            if (window.trendChart) {
                if (year === 2025) {
                    // Use 2024 data for 2025
                    window.trendChart.data.datasets[0].data = [85, 86, 87, 88, 89, 90, 91, 92, 93, 92, 91, 94];
                    window.trendChart.data.datasets[1].data = [80, 82, 84, 85, 87, 88, 89, 90, 91, 92, 93, 95];
                } else {
                    // Reset to 2024 data
                    window.trendChart.data.datasets[0].data = [82, 84, 85, 83, 86, 87, 88, 87, 89, 88, 87, 89];
                    window.trendChart.data.datasets[1].data = [75, 77, 78, 80, 82, 83, 84, 85, 86, 87, 88, 90];
                }
                window.trendChart.update();
            }
        }

        // Show section function with improved mobile support
        function showSection(sectionId) {
            // Check session validity
            if (!sessionValid) {
                logout();
                return;
            }
            
            // For guest users, restrict access to certain sections
            if (currentUser && currentUser.role === 'guest') {
                if (sectionId !== 'dashboard' && sectionId !== 'galeri') {
                    alert('Akses ke menu ini hanya untuk admin');
                    return;
                }
            }
            
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.classList.remove('hidden');
                selectedSection.classList.add('fade-in');
                
                // Scroll to top
                document.querySelector('.scroll-container').scrollTop = 0;
            }
            
            // Update navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            const activeNavItem = Array.from(navItems).find(item => 
                item.getAttribute('onclick').includes(sectionId)
            );
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
            
            // Initialize chart for dashboard
            if (sectionId === 'dashboard') {
                setTimeout(() => {
                    initTrendChart();
                }, 100);
            }
            
            // Initialize gallery for galeri page
            if (sectionId === 'galeri') {
                setTimeout(() => {
                    initGallery();
                }, 100);
            }
        }

        // Initialize trend chart
        function initTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;
            
            window.trendChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
                    datasets: [{
                        label: 'Kepatuhan K3RS (%)',
                        data: [82, 84, 85, 83, 86, 87, 88, 87, 89, 88, 87, 89],
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1
                    }, {
                        label: 'Risiko Teridentifikasi (%)',
                        data: [75, 77, 78, 80, 82, 83, 84, 85, 86, 87, 88, 90],
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: 'rgb(239, 68, 68)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Show detail modal with risk assessment
        function showDetail(room, month, type) {
            const modal = document.getElementById('detailModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = `Detail Laporan ${type} - ${room} - ${getMonthName(month)} ${currentYear}`;

            // Generate detailed content based on type
            let content = '';
            switch(type) {
                case 'APAR':
                    content = generateAparDetail(room, month);
                    break;
                case 'Kebakaran':
                    content = generateKebakaranDetail(room, month);
                    break;
                case 'Bencana':
                    content = generateBencanaDetail(room, month);
                    break;
                case 'Keamanan':
                    content = generateKeamananDetail(room, month);
                    break;
                case 'B3':
                    content = generateB3Detail(room, month);
                    break;
                case 'Fasilitas':
                    content = generateFasilitasDetail(room, month);
                    break;
            }

            modalContent.innerHTML = content;
            modal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('detailModal');
            modal.classList.remove('active');
        }

        // Toggle team modal
        function toggleMenu() {
            const teamModal = document.getElementById('teamModal');
            teamModal.classList.toggle('active');
        }

        // Close team modal
        function closeTeamModal() {
            const teamModal = document.getElementById('teamModal');
            teamModal.classList.remove('active');
        }

        // Generate risk assessment table
        function generateRiskAssessment(room) {
            const risks = [
                { name: 'Kerusakan Alat Medis', likelihood: 4, impact: 5, risk: 20, mitigation: 'Perawatan rutin, kalibrasi berkala' },
                { name: 'Infeksi Nosokomial', likelihood: 3, impact: 4, risk: 12, mitigation: 'Protokol sterilisasi, monitoring rutin' },
                { name: 'Kecelakaan Kerja', likelihood: 2, impact: 3, risk: 6, mitigation: 'Pelatihan K3, SOP jelas' },
                { name: 'Kerusakan Infrastruktur', likelihood: 3, impact: 4, risk: 12, mitigation: 'Inspeksi berkala, perbaikan cepat' },
                { name: 'Kehilangan Data', likelihood: 2, impact: 5, risk: 10, mitigation: 'Backup otomatis, enkripsi data' }
            ];

            let tableHtml = `
                <table class="risk-table">
                    <thead>
                        <tr>
                            <th>Risiko</th>
                            <th>Kemungkinan</th>
                            <th>Dampak</th>
                            <th>Skor Risiko</th>
                            <th>Mitigasi</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            risks.forEach(risk => {
                const riskClass = risk.risk >= 15 ? 'risk-high' : risk.risk >= 10 ? 'risk-medium' : 'risk-low';
                tableHtml += `
                    <tr>
                        <td>${risk.name}</td>
                        <td>${risk.likelihood}</td>
                        <td>${risk.impact}</td>
                        <td class="${riskClass}">${risk.risk}</td>
                        <td>${risk.mitigation}</td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            `;

            return tableHtml;
        }

        // Generate compliance assessment table
        function generateComplianceAssessment(room, type) {
            const items = [
                { name: 'Ketersediaan APAR', status: type === 'APAR' ? 'Tersedia' : 'Tidak Tersedia', score: type === 'APAR' ? 80 : 20 },
                { name: 'Pemeliharaan Rutin', status: 'Baik', score: 85 },
                { name: 'Pelatihan Staf', status: 'Sedang', score: 60 },
                { name: 'Dokumentasi', status: 'Baik', score: 75 },
                { name: 'Inspeksi Bulanan', status: 'Baik', score: 80 }
            ];

            let tableHtml = `
                <table class="compliance-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Status</th>
                            <th>Skor</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            items.forEach(item => {
                let statusClass = '';
                if (item.score >= 80) {
                    statusClass = 'compliance-good';
                } else if (item.score >= 60) {
                    statusClass = 'compliance-medium';
                } else {
                    statusClass = 'compliance-poor';
                }

                tableHtml += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.status}</td>
                        <td class="${statusClass}">${item.score}%</td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            `;

            return tableHtml;
        }

        // Show monthly reports for each category
        function showMonthlyApar(month) {
            updateMonthTabs('apar', month);
            const grid = document.getElementById('aparGrid');
            
            grid.innerHTML = rooms.map(room => {
                const hasApar = roomsWithApar.includes(room);
                const needRefill = roomsNeedRefill.includes(room);
                
                let statusClass = '';
                let statusText = '';
                let statusIcon = '';
                
                if (hasApar && !needRefill) {
                    statusClass = 'status-success';
                    statusText = 'Tersedia';
                    statusIcon = 'fas fa-check-circle';
                } else if (hasApar && needRefill) {
                    statusClass = 'status-warning';
                    statusText = 'Perlu Isi Ulang';
                    statusIcon = 'fas fa-exclamation-triangle';
                } else {
                    statusClass = 'status-danger';
                    statusText = 'Tidak Tersedia';
                    statusIcon = 'fas fa-times-circle';
                }
                
                return `
                    <div class="room-card" onclick="showDetail('${room}', '${month}', 'APAR')">
                        <h4 class="room-name">${room}</h4>
                        <div class="room-info">
                            <span class="text-xs text-gray-600">APAR 2kg</span>
                            <span class="status-badge ${statusClass}">
                                <i class="${statusIcon} mr-1"></i>${statusText}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showMonthlyKebakaran(month) {
            updateMonthTabs('kebakaran', month);
            const grid = document.getElementById('kebakaranGrid');
            
            grid.innerHTML = rooms.map(room => `
                <div class="room-card" onclick="showDetail('${room}', '${month}', 'Kebakaran')">
                    <h4 class="room-name">${room}</h4>
                    <div class="room-info">
                        <span class="text-xs text-gray-600">Tidak ada AP</span>
                        <span class="status-badge status-danger">Perbaatan</span>
                    </div>
                </div>
            `).join('');
        }

        function showMonthlyBencana(month) {
            updateMonthTabs('bencana', month);
            const grid = document.getElementById('bencanaGrid');
            grid.innerHTML = rooms.map(room => {
                const readiness = generateRandomData(60, 95);
                let statusClass = '';
                if (readiness > 80) {
                    statusClass = 'status-success';
                } else if (readiness >= 60) {
                    statusClass = 'status-warning';
                } else {
                    statusClass = 'status-danger';
                }
                
                return `
                    <div class="room-card" onclick="showDetail('${room}', '${month}', 'Bencana')">
                        <h4 class="room-name">${room}</h4>
                        <div class="room-info">
                            <span class="text-xs text-gray-600">${readiness}%</span>
                            <span class="status-badge ${statusClass}">${readiness > 80 ? 'Tinggi' : readiness >= 60 ? 'Sedang' : 'Rendah'}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showMonthlyKeamanan(month) {
            updateMonthTabs('keamanan', month);
            const grid = document.getElementById('keamananGrid');
            grid.innerHTML = rooms.map(room => {
                const security = generateRandomData(80, 100);
                let statusClass = '';
                let statusText = '';
                
                if (security > 90) {
                    statusClass = 'status-success';
                    statusText = 'Normal';
                } else if (security >= 80) {
                    statusClass = 'status-warning';
                    statusText = 'Perhatian';
                } else {
                    statusClass = 'status-danger';
                    statusText = 'Kritis';
                }
                
                return `
                    <div class="room-card" onclick="showDetail('${room}', '${month}', 'Keamanan')">
                        <h4 class="room-name">${room}</h4>
                        <div class="room-info">
                            <span class="text-xs text-gray-600">${security}%</span>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showMonthlyB3(month) {
            updateMonthTabs('b3', month);
            const grid = document.getElementById('b3Grid');
            grid.innerHTML = rooms.map(room => {
                const compliance = generateRandomData(70, 100);
                let statusClass = '';
                if (compliance > 80) {
                    statusClass = 'status-success';
                } else if (compliance >= 60) {
                    statusClass = 'status-warning';
                } else {
                    statusClass = 'status-danger';
                }
                
                return `
                    <div class="room-card" onclick="showDetail('${room}', '${month}', 'B3')">
                        <h4 class="room-name">${room}</h4>
                        <div class="room-info">
                            <span class="text-xs text-gray-600">${compliance}%</span>
                            <span class="status-badge ${statusClass}">${compliance > 80 ? 'Tinggi' : compliance >= 60 ? 'Sedang' : 'Rendah'}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showMonthlyFasilitas(month) {
            updateMonthTabs('fasilitas', month);
            const grid = document.getElementById('fasilitasGrid');
            grid.innerHTML = rooms.map(room => {
                const facility = generateRandomData(70, 100);
                let statusClass = '';
                let statusText = '';
                
                if (facility > 85) {
                    statusClass = 'status-success';
                    statusText = 'Baik';
                } else if (facility >= 70) {
                    statusClass = 'status-warning';
                    statusText = 'Perlu Perawatan';
                } else {
                    statusClass = 'status-danger';
                    statusText = 'Rusak';
                }
                
                return `
                    <div class="room-card" onclick="showDetail('${room}', '${month}', 'Fasilitas')">
                        <h4 class="room-name">${room}</h4>
                        <div class="room-info">
                            <span class="text-xs text-gray-600">${facility}%</span>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMonthTabs(category, activeMonth) {
            const tabs = document.querySelectorAll(`#${category} .tab`);
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = Array.from(tabs).find(tab => tab.textContent.toLowerCase().includes(activeMonth));
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }

        // Generate detailed reports with risk assessment
        function generateAparDetail(room, month) {
            const hasApar = roomsWithApar.includes(room);
            const needRefill = roomsNeedRefill.includes(room);
            
            let statusClass = '';
            let statusText = '';
            let statusIcon = '';
            
            if (hasApar && !needRefill) {
                statusClass = 'status-success';
                statusText = 'Tersedia';
                statusIcon = 'fas fa-check-circle';
            } else if (hasApar && needRefill) {
                statusClass = 'status-warning';
                statusText = 'Perlu Isi Ulang';
                statusIcon = 'fas fa-exclamation-triangle';
            } else {
                statusClass = 'status-danger';
                statusText = 'Tidak Tersedia';
                statusIcon = 'fas fa-times-circle';
            }
            
            return `
                <div class="space-y-4">
                    <div class="${statusClass.includes('danger') ? 'bg-red-50 p-3 rounded-lg' : statusClass.includes('warning') ? 'bg-yellow-50 p-3 rounded-lg' : 'bg-green-50 p-3 rounded-lg'}">
                        <div class="flex items-center">
                            <i class="${statusIcon} mr-2"></i>
                            <h4 class="font-semibold mb-1 text-sm">Status APAR 2kg</h4>
                        </div>
                        <p class="text-xs">${room}: ${statusText}</p>
                    </div>
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Risiko</h4>
                    ${generateRiskAssessment(room)}
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Kepatuhan</h4>
                    ${generateComplianceAssessment(room, 'APAR')}
                    
                    <div class="recommendations">
                        <h4 class="recommendations-title">Rekomendasi</h4>
                        <ul class="recommendations-list">
                            ${!hasApar ? '<li>â€¢ Segera pasang minimal 1 unit APAR 2kg di ruangan ini</li>' : ''}
                            ${needRefill ? '<li>â€¢ Isi ulang APAR 2kg di ruangan ini</li>' : ''}
                            <li>â€¢ Lakukan inspeksi rutin setiap bulan</li>
                            <li>â€¢ Pastikan staf mengetahui penggunaan APAR</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateKebakaranDetail(room, month) {
            return `
                <div class="space-y-4">
                    <div class="bg-red-50 p-3 rounded-lg">
                        <h4 class="font-semibold text-red-900 mb-1 text-sm">Status Kebakaran</h4>
                        <p class="text-xs text-red-800">Pada bulan ${getMonthName(month)}, ruangan ${room} tidak memiliki AP 2kg, AP 9kg, AP kering, atau alarm kebakaran. Hanya jalur evakuasi yang tersedia.</p>
                    </div>
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Risiko</h4>
                    ${generateRiskAssessment(room)}
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Kepatuhan</h4>
                    ${generateComplianceAssessment(room, 'Kebakaran')}
                    
                    <div class="recommendations">
                        <h4 class="recommendations-title">Rekomendasi</h4>
                        <ul class="recommendations-list">
                            <li>â€¢ Segera pasang minimal 1 unit AP 2kg</li>
                            <li>â€¢ Pertimbangkan untuk menambahkan AP 9kg</li>
                            <li>â€¢ Pasang alarm kebakaran untuk keamanan maksimal</li>
                            <li>â€¢ Pertahankan jalur evakuasi selalu bebas dari hambatan</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateBencanaDetail(room, month) {
            const readiness = generateRandomData(60, 95);
            let statusClass = '';
            if (readiness > 80) {
                statusClass = 'status-success';
            } else if (readiness >= 60) {
                statusClass = 'status-warning';
            } else {
                statusClass = 'status-danger';
            }
            
            return `
                <div class="space-y-4">
                    <div class="bg-purple-50 p-3 rounded-lg">
                        <h4 class="font-semibold text-purple-900 mb-1 text-sm">Kesiapan Bencana</h4>
                        <p class="text-xs text-purple-800">Ruangan ${room} siap menghadapi bencana alam dengan tingkat kesiapan ${readiness}%</p>
                    </div>
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Risiko</h4>
                    ${generateRiskAssessment(room)}
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Kepatuhan</h4>
                    ${generateComplianceAssessment(room, 'Bencana')}
                    
                    <div class="recommendations">
                        <h4 class="recommendations-title">Rekomendasi</h4>
                        <ul class="recommendations-list">
                            <li>â€¢ Sediakan P3K minimal di setiap ruangan</li>
                            <li>â€¢ Lakukan simulasi evakuasi minimal 1 kali setiap 6 bulan</li>
                            <li>â€¢ Pastikan semua staf mengetahui prosedur evakuasi</li>
                            <li>â€¢ Sediakan jalur evakuasi alternatif</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateKeamananDetail(room, month) {
            const security = generateRandomData(80, 100);
            let statusClass = '';
            let statusText = '';
            
            if (security > 90) {
                statusClass = 'status-success';
                statusText = 'Normal';
            } else if (security >= 80) {
                statusClass = 'status-warning';
                statusText = 'Perhatian';
            } else {
                statusClass = 'status-danger';
                statusText = 'Kritis';
            }
            
            return `
                <div class="space-y-4">
                    <div class="bg-green-50 p-3 rounded-lg">
                        <h4 class="font-semibold text-green-900 mb-1 text-sm">Status Keamanan</h4>
                        <p class="text-xs text-green-800">Keamanan ruangan ${room} dalam kondisi ${security}% ${statusText}</p>
                    </div>
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Risiko</h4>
                    ${generateRiskAssessment(room)}
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Kepatuhan</h4>
                    ${generateComplianceAssessment(room, 'Keamanan')}
                    
                    <div class="recommendations">
                        <h4 class="recommendations-title">Rekomendasi</h4>
                        <ul class="recommendations-list">
                            <li>â€¢ Pasang CCTV di area kritis</li>
                            <li>â€¢ Pasang alarm keamanan di setiap lantai</li>
                            <li>â€¢ Lakukan patroli rutin setiap 2 jam</li>
                            <li>â€¢ Sediakan sistem interkom darurat</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateB3Detail(room, month) {
            const compliance = generateRandomData(70, 100);
            let statusClass = '';
            if (compliance > 80) {
                statusClass = 'status-success';
            } else if (compliance >= 60) {
                statusClass = 'status-warning';
            } else {
                statusClass = 'status-danger';
            }
            
            return `
                <div class="space-y-4">
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <h4 class="font-semibold text-yellow-900 mb-1 text-sm">Status B3</h4>
                        <p class="text-xs text-yellow-800">Pengelolaan B3 di ruangan ${room} sesuai standar ${compliance}%</p>
                    </div>
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Risiko</h4>
                    ${generateRiskAssessment(room)}
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Kepatuhan</h4>
                    ${generateComplianceAssessment(room, 'B3')}
                    
                    <div class="recommendations">
                        <h4 class="recommendations-title">Rekomendasi</h4>
                        <ul class="recommendations-list">
                            <li>â€¢ Pisahkan limbah medis dan non medis dengan jelas</li>
                            <li>â€¢ Sediakan tempat penimbunan limbah B3 khusus</li>
                            <li>â€¢ Lakukan pelatihan pengelolaan limbah B3 minimal 1 kali setahun</li>
                            <li>â€¢ Dokumentasikan semua aktivitas pengelolaan limbah B3</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateFasilitasDetail(room, month) {
            const facility = generateRandomData(70, 100);
            let statusClass = '';
            let statusText = '';
            
            if (facility > 85) {
                statusClass = 'status-success';
                statusText = 'Baik';
            } else if (facility >= 70) {
                statusClass = 'status-warning';
                statusText = 'Perlu Perawatan';
            } else {
                statusClass = 'status-danger';
                statusText = 'Rusak';
            }
            
            return `
                <div class="space-y-4">
                    <div class="bg-indigo-50 p-3 rounded-lg">
                        <h4 class="font-semibold text-indigo-900 mb-1 text-sm">Status Fasilitas</h4>
                        <p class="text-xs text-indigo-800">Kondisi fasilitas di ${room} normal dan berfungsi dengan ${statusText}</p>
                    </div>
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Risiko</h4>
                    ${generateRiskAssessment(room)}
                    
                    <h4 class="font-semibold text-gray-800 mb-2 text-sm">Penilaian Kepatuhan</h4>
                    ${generateComplianceAssessment(room, 'Fasilitas')}
                    
                    <div class="recommendations">
                        <h4 class="recommendations-title">Rekomendasi</h4>
                        <ul class="recommendations-list">
                            <li>â€¢ Lakukan pemeliharaan AC minimal 2 kali setahun</li>
                            <li>â€¢ Periksa instalasi listrik setiap 3 bulan</li>
                            <li>â€¢ Ganti filter air setiap 6 bulan</li>
                            <li>â€¢ Dokumentasikan semua aktivitas pemeliharaan</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
        }

        // Get month name
        function getMonthName(month) {
            const months = {
                'jan': 'Januari',
                'feb': 'Februari',
                'mar': 'Maret',
                'apr': 'April',
                'mei': 'Mei',
                'jun': 'Juni',
                'jul': 'Juli',
                'agu': 'Agustus',
                'sep': 'September',
                'okt': 'Oktober',
                'nov': 'November',
                'des': 'Desember'
            };
            return months[month] || month;
        }

        // Login functions
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple authentication - in real app, this would be server-side
            if (username === 'mfk2023' && password === 'mfk2023') {
                currentUser = {
                    id: username,
                    name: 'Admin K3RS/MFK',
                    role: 'admin'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainApp();
            } else {
                alert('ID Petugas atau Password salah. Silakan coba lagi.');
            }
        }

        function loginAsGuest() {
            currentUser = {
                id: 'guest',
                name: 'Tamu',
                role: 'guest'
            };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainApp();
        }

        function showMainApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update user info
            if (currentUser && currentUser.role === 'admin') {
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.name;
                updateNavigationForAdmin();
            } else {
                updateNavigationForGuest();
            }
            
            // Show dashboard
            showSection('dashboard');
        }

        function updateNavigationForAdmin() {
            // Enable all navigation items for admin
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('locked-nav-item');
            });
            
            // Hide guest logout button
            document.getElementById('guestLogout').style.display = 'none';
        }

        function updateNavigationForGuest() {
            // Lock navigation items for guest (except dashboard and galeri)
            const navItems = ['navApar', 'navKebakaran', 'navBencana', 'navKeamanan', 'navB3', 'navFasilitas'];
            navItems.forEach(id => {
                const item = document.getElementById(id);
                if (item) {
                    item.classList.add('locked-nav-item');
                }
            });
            
            // Show guest logout button
            document.getElementById('guestLogout').style.display = 'flex';
        }

        // Pull to refresh functionality
        function initPullToRefresh() {
            const scrollContainer = document.querySelector('.scroll-container');
            const pullToRefresh = document.getElementById('pullToRefresh');
            
            // Touch events for mobile
            scrollContainer.addEventListener('touchstart', (e) => {
                if (scrollContainer.scrollTop === 0) {
                    pullStartY = e.touches[0].clientY;
                    isPulling = true;
                }
            });
            
            scrollContainer.addEventListener('touchmove', (e) => {
                if (!isPulling) return;
                
                const currentY = e.touches[0].clientY;
                pullDistance = currentY - pullStartY;
                
                if (pullDistance > 0 && pullDistance < 100) {
                    pullToRefresh.classList.add('active');
                    pullToRefresh.style.transform = `translateY(${pullDistance * 0.5}px)`;
                }
            });
            
            scrollContainer.addEventListener('touchend', () => {
                if (!isPulling) return;
                
                isPulling = false;
                
                if (pullDistance > 80) {
                    // Trigger refresh
                    isRefreshing = true;
                    pullToRefresh.querySelector('i').style.animation = 'spin 1s linear infinite';
                    
                    // Simulate refresh delay
                    setTimeout(() => {
                        // Clear session and redirect to login
                        logout();
                        isRefreshing = false;
                        pullToRefresh.querySelector('i').style.animation = '';
                    }, 1500);
                }
                
                pullDistance = 0;
                pullToRefresh.classList.remove('active');
                pullToRefresh.style.transform = '';
            });
            
            // Mouse events for desktop
            scrollContainer.addEventListener('mousedown', (e) => {
                if (scrollContainer.scrollTop === 0) {
                    pullStartY = e.clientY;
                    isPulling = true;
                }
            });
            
            scrollContainer.addEventListener('mousemove', (e) => {
                if (!isPulling) return;
                
                const currentY = e.clientY;
                pullDistance = currentY - pullStartY;
                
                if (pullDistance > 0 && pullDistance < 100) {
                    pullToRefresh.classList.add('active');
                    pullToRefresh.style.transform = `translateY(${pullDistance * 0.5}px)`;
                }
            });
            
            scrollContainer.addEventListener('mouseup', () => {
                if (!isPulling) return;
                
                isPulling = false;
                
                if (pullDistance > 80) {
                    // Trigger refresh
                    isRefreshing = true;
                    pullToRefresh.querySelector('i').style.animation = 'spin 1s linear infinite';
                    
                    // Simulate refresh delay
                    setTimeout(() => {
                        // Clear session and redirect to login
                        logout();
                        isRefreshing = false;
                        pullToRefresh.querySelector('i').style.animation = '';
                    }, 1500);
                }
                
                pullDistance = 0;
                pullToRefresh.classList.remove('active');
                pullToRefresh.style.transform = '';
            });
        }

        // Initialize on load
        window.addEventListener('load', () => {
            // Initialize security features
            preventScreenshot();
            
            // Initialize pull to refresh
            initPullToRefresh();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            } else {
                // Show login page
                document.getElementById('loginPage').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
        });

        // Handle back button for mobile
        window.addEventListener('popstate', (e) => {
            e.preventDefault();
            if (currentUser && currentUser.role === 'admin') {
                showSection('dashboard');
            } else {
                // For guest users, prevent navigation back
                history.pushState(null, null, location.href);
            }
        });
    </script>
</body>
</html>
